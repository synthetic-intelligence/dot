#! /usr/bin/env -S bash -e

git pull

bundle install

if [[ ! -e db/development.sqlite3 ]]
then
    echo "migrating development"
    rails db:migrate
    rails db:seed
else
    echo "using db/development.sqlite3"
fi

if [[ ! -e db/test.sqlite3 ]]
then
    echo "migrating test"
    rails db:migrate RAILS_ENV=test
fi

# bin/rails tmp:clear
rails test
# rails test:system
# bin/rails tmp:clear
rails server
